{% extends 'base.html' %}

{% load static %}

{% block content %}
<section id="page-title" class="page-title bg-overlay bg-parallax bg-overlay-gradient">
    <div class="bg-section">
        <img src="{% static 'img/order_main.jpg' %}" alt="Background" />
    </div>
    <div class="container">
        <div class="row-colums">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <div class="title title-4 text-center">
                    <div class="title--content">
                        <div class="title--subtitle">Products</div>
                        <div class="title--heading">
                            <h1>Shopping Cart</h1>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <ol class="breadcrumb">
                        <li><a href="{% url 'home' %}">Home</a></li>
                        <li class="active">Cart</li>
                    </ol>
                    <div class="divider--shape-1down divider--shape-gray"></div>
                </div>
                <!-- .title end -->
            </div>
            <!-- .col-md-12 end -->
        </div>
        <!-- .row end -->
    </div>
    <!-- .container end -->
</section>
<!-- #page-title end -->

<!-- Shop Cart
============================================= -->
<section id="shopcart" class="shop shop-cart bg-gray">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                {% if cart.is_empty %}
                <!-- Пустая корзина -->
                <div class="empty-cart text-center">
                    <h3>Your cart is empty</h3>
                    <p>Add some delicious dishes from our menu!</p>
                    <a href="{% url 'menu:list' %}" class="btn btn--primary">Go to Menu</a>
                </div>
                {% else %}
                <div class="cart-table table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr class="cart-product">
                                <th class="cart-product-item">Product</th>
                                <th class="cart-product-price">Price</th>
                                <th class="cart-product-quantity">Quantity</th>
                                <th class="cart-product-total">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for item in cart_items %}
                            <tr class="cart-product" id="cart-item-{{ item.dish_id }}">
                                <td class="cart-product-item-{{ item.dish_id }}">
                                    <div class="cart-product-remove">
                                        <a href="#" class="remove-item" data-dish-id="{{ item.dish_id }}" title="Remove">
                                        <i class="fa fa-close"></i>
                                        </a>
                                    </div>
                                    <div class="cart-product-name">
                                        <h6>{{ item.dish.name }}</h6>
                                    </div>
                                </td>
                                <td class="cart-product-price">$ {{ item.price }}</td>
                                <td class="cart-product-quantity">
                                    <div class="product-quantity">
                                        <form method="post" action="{% url 'orders:cart_update' %}" class="update-quantity-form" id="form-{{ item.dish_id }}">
                                            {% csrf_token %}
                                            <input type="hidden" name="dish_id" value="{{ item.dish_id }}">
                                            <!-- Минус -->
                                            <a href="#" class="quantity-change" data-action="decrease" data-dish-id="{{ item.dish_id }}">
                                                <i class="fa fa-minus"></i>
                                            </a>
                                            <!-- Поле количества -->
                                            <input type="text"
                                                   name="quantity"
                                                   value="{{ item.quantity }}"
                                                   class="quantity-input"
                                                   id="quantity-{{ item.dish_id }}"
                                                   data-dish-id="{{ item.dish_id }}"
                                                   data-unit-price="{{ item.price }}"
                                                   readonly>
                                            <!-- Плюс -->
                                            <a href="#" class="quantity-change" data-action="increase" data-dish-id="{{ item.dish_id }}">
                                                <i class="fa fa-plus"></i>
                                            </a>
                                        </form>
                                    </div>
                                </td>
                                <td class="cart-product-total">$ <span class="price-value">{{ item.total_price }}</span></td>
                            </tr>
                        {% endfor %}
                            <tr class="cart-product-action">
                                <td colspan="4">
                                    <div class="row clearfix">
                                        <div class="col-xs-12 col-sm-6 col-md-6">
                                            <form id="coupon-form" method="post" action="{% url 'orders:apply_coupon' %}" class="form-inline" style="display: flex">
                                                {% csrf_token %}
                                                <div class="field-coupon">
                                                   <input type="text" class="form-control" name="coupon_code" id="coupon-code" placeholder="Coupon Code">
                                                   <div class="form-error coupon-error" style="display:none; color: red"></div>
                                                </div>
                                                <button type="submit" class="btn btn--primary">Apply Coupon</button>

                                            </form>
                                        </div>
                                        <!-- .col-md-6 end -->
                                        <div class="col-xs-12 col-sm-6 col-md-6 text-right total-cost-order">
                                                <h6 class="cart-shiping-details" style="margin: 0">Total Cost</h6>
                                                <h6 class="cart-shiping-details" style="margin: 0; color: #c59d5f; width: 60px;">
                                                    <span class="price-value">$ {{ cart_subtotal }}</span>
                                                </h6>
                                        </div>
                                        <div class="col-xs-12 col-sm-6 col-md-6 text-right total-cost-order">
                                                {% if cart_subtotal < free_delivery_threshold %}
                                                <p class="delivery-message" style="margin:10px 0">Order amount less than $ {{ free_delivery_threshold }}. Delivery will be charged $ {{ fixed_delivery_cost }}.</p>
                                                {% else %}
                                                <p class="" style="margin:10px 0">The order will be delivered free of charge.</p>
                                                {% endif %}
                                        </div>
                                        <!-- .col-md-6 end -->
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="divider--shape-4"></div>
                <!-- .cart-table end -->
            </div>
            <!-- .col-md-12 end -->
            <div class="col-xs-12 col-sm-12  col-md-6">
                <div class="cart-total-amount">
                    <h6 class="cart-shiping-details">Enter delivery details :</h6>
                    <div class="row">
                        <form method="post" action="" id="checkout-form" class="orderForm mb-0" style="padding: 20px">
                            {% csrf_token %}
                            <div class="col-xs-12 col-sm-12 col-md-6">
                                <input type="text" class="form-control" name="customer_name" id="name"
                                       placeholder="Your Name" required=""
                                       value="{{ request.session.order_customer_name|default:'' }}">
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-6">
                                <input type="text" class="form-control" name="phone_number" id="phone"
                                       placeholder="Your Phone Number" required=""
                                       pattern="\+7\s?[0-9]{3}\s?[0-9]{3}\s?[0-9]{2}\s?[0-9]{2}"
                                       value="{{ request.session.order_phone_number|default:'' }}">
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <input type="text" class="form-control" name="delivery_address" id="address"
                                       placeholder="Your Delivery Address" required=""
                                       value="{{ request.session.order_delivery_address|default:'' }}">
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                 <p>Payment to the courier:</p>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <div class="col-xs-12 col-sm-12 col-md-6 form-radio">
	                                <input id="radio-1" type="radio" name="payment_method" value="cash" checked>
	                                <label for="radio-1">Cash</label>
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-6 form-radio">
	                                <input id="radio-2" type="radio" name="payment_method" value="card">
	                                <label for="radio-2">Bank Card</label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- .cart-shiping end -->
            </div>
            <!-- .col-md-6 end -->
            <div class="col-xs-12 col-sm-12  col-md-6">
                <div class="cart-total-amount">
                    <h6>Cart Totals :</h6>
                    <ul class="list-unstyled">
                        <li>Cart Subtotal :<span class="pull-right text-right">$ <span class="price-value">{{ cart_subtotal }}</span></span></li>
                        <li class="cart-discount" style="display:none;">
                            Discount :
                            <span class="pull-right text-right">
                                $ <span class="price-value">0.00</span>
                            </span>
                        </li>
                        <li>Delivery :
                            <span class="pull-right text-right">{% if delivery_cost == 0 %} Free {% else %} $ <span class="price-value">{{ delivery_cost }}</span> {% endif %}
                            </span>
                        </li>
                        <li>Order Total :<span class="pull-right text-right">$ <span class="price-value">{{ final_price }}</span></span></li>
                    </ul>
                </div>
                <!-- .cart-total-amount end -->
            </div>
            <!-- .col-md-6 end -->
        </div>
        <div class="divider--shape-4" style="margin-top: 30px"></div>
        <div class="md-6 text-center" style="margin: 40px 0 20px 0">
            <p>To confirm your order and delivery address, we will send you a code via SMS.</p>
            <button type="submit" class="btn btn--primary" form="checkout-form" id="confirm-order-btn">confirm order</button>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 mt-3">
            <div class="form-check" style="text-align: center">
                <input type="checkbox" class="form-check-input" name="agree" id="agree" required>
                   <label class="form-check-label" style="margin-left: 5px">
                       I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#terms-txt">Terms and Privacy Policy</a>
                   </label>
            </div>
        </div>
            {% if not cart.is_empty %}
        <div id="sms-verification-section" class="col-xs-12 col-sm-12  col-md-6 send-sms hidden">
            <div class="col-md-4 field-send-sms">
                <input type="text" class="form-control field-sms-code" name="sms_code" id="sms" placeholder="Code" required="">
                <div class="form-error sms-error" style="display:none; color: red; padding-bottom: 20px;"></div>
            </div>
            <div class="col-md-4 btn-send-sms">
                <button class="btn btn--primary" id="verify-sms-btn">send code</button>
            </div>
        </div>
           {% endif %}
        {% endif %}
        <!-- .row end -->
    </div>
     <!-- Сообщение об удалении блюда из корзины  -->
    <div id="confirm-modal" class="confirm-modal hidden">
        <div class="confirm-box">
            <p>Remove this item from your cart?</p>
            <div class="confirm-actions">
                <button id="confirm-remove" class="btn btn--primary">Yes</button>
                <button id="cancel-remove" class="btn btn--secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Сообщение об успешном принятии заказа  -->
    <div id="order-confirmation-modal" class="order-confirmation-modal hidden">
        <div class="confirmation-content">
            <h3 class="success-title">Your order has been accepted!</h3>

            <p class="success-text">
                It will be ready within an hour. Wait for the courier's call!
            </p>

            <div class="confirmation-actions">
                <a href="{% url 'home' %}" class="btn btn--primary">Home</a>
                <a href="{% url 'menu:list' %}" class="btn btn--primary">Menu</a>
            </div>
        </div>
    </div>

    <!-- .container end -->
</section>

<script src="{% static 'js/orders.js' %}"></script>

{% endblock %}